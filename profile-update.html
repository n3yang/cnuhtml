<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="css/base.css" type="text/css" />
<link rel="stylesheet" href="css/flexslider.min.css" type="text/css"/>
<link rel="stylesheet" href="css/jquery.fancybox.css" type="text/css" />
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="js/placeholder.js"></script>
<script type="text/javascript" src="js/jquery.flexslider.min.js"></script>
<script type="text/javascript" src="js/jquery.fancybox.pack.js"></script>
<script type="text/javascript" src="js/jquery.cnuaction.js"></script>
<script type="text/javascript" src="js/jquery.form.js"></script>
<script type="text/javascript" src="js/baiduTemplate.js"></script>
<script type="text/javascript" src="js/main.js"></script>

<link rel="stylesheet" href="css/alumnus.css" type="text/css" />

<title>首都师范大学校友会</title>

</head>

<body>

<div class="wrap">
  <div class="logo-wrap">
    	<img id="logo" src="images/logo.gif" alt="首师大Logo" title="首都师范大学" />
    </div>
    
    
    <div class="nav-wrap base-clear">
    	<ul class="nav">
        	<li><a href="./alumnus.html">校友信息</a></li>
        	<li><a href="./dynamic.html">母校信息</a></li>
        	<li><a href="personal.html">个人信息</a></li>
        	<li id="sid_admin"><a href="./administration.html">管理</a></li>
        	<li><a href="./setup.html">系统设置</a></li>
        </ul>
        <div class="search-box">
        	<input class="search-text" placeholder="找同学" type="text" />
            <input class="search-btn" type="button"/>
        </div>
    </div>
    
    <div class="m-d-20">
    </div>
    
    <div id="search_wrap" class="setup-wrap">
    	<h3 class="setup-title">系统设置</h3>
        <div class="setup-box base-clear">
        	<div class="setup-left">
            	<form id="p-form" method="post" enctype="multipart/form-data" action="">
                <div class="form-box">
                    <h2 class="form-row-nolabel">完善个人信息</h2>
                    <div class="form-row">
                        <label class="label-text">姓名</label>
                        <input id="p-name" name="name" class="input-text" type="text" />
                        <div class="tips-box"></div>
                    </div>
                    <div class="form-row">
                        <label class="label-text">性别</label>
                        <select class="" id="p-gender" name="gender">
                            <option value="1" selected="selected">男</option>
                            <option value="0" selected="selected">女</option>
                        </select>
                        <div class="tips-box"></div>
                    </div>
                    <div class="form-row">
                        <label class="label-text">身份</label>
                        <select class="" id="p-type" name="type">
                            <option value="1" selected="selected">学生校友</option>
                            <option value="2" selected="selected">教工校友</option>
                        </select>
                        <div class="tips-box"></div>
                    </div>
                    <div class="form-row">
                        <label class="label-text">院系</label>
                        <select class="" id="p-deptId" name="deptId">
                        </select>
                        <select class="" id="p-majorId" name="majorId">
                            <option value="" selected="selected">专业</option>
                        </select>
                        <div class="tips-box"></div>
                    </div>
                    <div class="form-row">
                        <label class="label-text">班级</label>
                        <input id="p-clazz" name="clazz" class="input-text" type="input" />
                        <div class="tips-box"></div>
                    </div>
                    <div class="form-row">
                        <label class="label-text">入学年份</label>
                        <input id="p-adYear" name="adYear" class="input-text" type="input" />
                        <div class="tips-box"></div>
                    </div>
                    <div class="form-row">
                        <label class="label-text">组织结构</label>
                        <select class="" id="p-org1Id" name="org1Id">
                        </select>
                        <select class="" id="p-org2Id" name="org2Id">
                        </select>
                        <div class="tips-box"></div>
                    </div>
                    <div class="form-row">
                        <label class="label-text">工号</label>
                        <input id="p-empNo" name="empNo" class="input-text" type="input" />
                        <div class="tips-box"></div>
                    </div>
                    <div class="form-row">
                        <label class="label-text">手机号</label>
                        <input id="p-mobile" name="mobile" class="input-text" type="input" />
                        <div class="tips-box"></div>
                    </div>
                    <div class="form-row">
                        <label class="label-text">邮箱</label>
                        <input id="p-email" name="email" class="input-text" type="input" />
                        <div class="tips-box"></div>
                    </div>
                    <div class="form-row">
                        <label class="label-text">QQ号</label>
                        <input id="p-qq" name="qq" class="input-text" type="input" />
                        <div class="tips-box"></div>
                    </div>
                    <div class="form-row">
                        <label class="label-text">设置头像</label>
                        <input id="p-pic" name="pic" class="input-text" type="file" />
                        <div class="tips-box"></div>
                    </div>
                    <div class="form-row form-row-nolabel">
                        <input id="addnew-btn" class="input-btn" type="submit" value="保存" />
                    </div>
                </div>
                </form>
            </div>
        	<div class="setup-right">
            
                <div id="node-form-box" class="form-box">
                    
                    
				</div>
                
                    <div id="node-tpl" class="node active" style="display: none">
                        <h2 class="form-row-nolabel">个人履历<span class="node-seq"></span></h2>
                        <form name="" action="" method="post" onsubmit="return saveNode(this);" enctype="multipart/form-data">
                        <div class="form-row">
                            <label class="label-text">身份</label>
                            <input id="n-title" name="title" class="input-text" type="text" placeholder="比如硕士研究生、工程师" />
                            <div class="tips-box"></div>
                        </div>
                        <div class="form-row">
                            <label class="label-text">组织名称</label>
                            <input id="n-org" name="org" class="input-text" type="text" placeholder="组织名称，比如学校名或公司名" />
                            <div class="tips-box"></div>
                        </div>
                        <div class="form-row">
                            <label class="label-text">所属行业</label>
                            <select id="n-industry-id" name="industryId">
                            </select>
                            <div class="tips-box"></div>
                        </div>
                        <div class="form-row">
                            <label class="label-text">省份</label>
                            <input id="n-province" name="province" class="input-text" type="text" placeholder="地址（省或直辖市，比如河北省、北京市）" />
                            <div class="tips-box"></div>
                        </div>
                        <div class="form-row">
                            <label class="label-text">城市</label>
                            <input id="n-city"  name="city" class="input-text" type="text" placeholder="比如石家庄市、海淀区" />
                            <div class="tips-box"></div>
                        </div>
                        <div class="form-row">
                            <label class="label-text">开始时间</label>
                            <input id="n-stime" name="stime" class="input-text" type="input" />
                            <div class="tips-box"></div>
                        </div>
                        <div class="form-row">
                            <label class="label-text">结束时间</label>
                            <input id="n-etime" name="etime" class="input-text" type="input" />
                            <div class="tips-box"></div>
                        </div>
                        <div class="form-row">
                            <label class="label-text">位置（之后）</label>
                            <select class="" id="n-after-id" name="afterID">
                            </select>
                            <div class="tips-box"></div>
                        </div>
                        <div class="form-row">
                            <label class="label-text">图片</label>
                            <input id="n-pic" name="pic" class="input-text" type="file" />
                            <div class="tips-box"></div>
                        </div>
                        <div class="form-row form-row-nolabel">
                            <input id="n-id" name="id" type="hidden" value="" />
                            <input id="btn-n-save" class="input-btn" type="submit" value="保存" />
                            <input id="btn-n-remove" class="input-btn m-l-20" type="button" value="删除" onclick="return removeNode(this);" />
                        </div>
                        </form>
                    </div>
                

				<div class="form-box">
                    <div class="form-row form-row-nolabel">
                        <input id="btn-node-add" class="input-btn w-200" type="button" value="新增个人履历" />
                    </div>
                </div>
                               
            </div>
            
        </div>
    </div>
    
</div>

<div class="footer">
<p>
    备案号：京公网安备:110402430068号<br>
    校友会地址：北京市海淀区西三环北路105号首都师范大学学校办公室校友会 邮编：100048   邮箱：cnuxyh@126.com<br>
    联系方式：电话：86-10-68902418、86-10-68902611  传真：86-10-68902418<br>
</p>
</div>

<script id="t:tpl-search" type="text/html">



</script>



<script type="text/javascript">

//------- save node
function saveNode(n){
    if ($(n).find("input[name='title']").val()==''){
        setFancyBox('请输入身份');
        return false;
    }
    if ($(n).find("input[name='org']").val()==''){
        setFancyBox('请输入组织名称');
        return false;
    }
    if ($(n).find("input[name='stime']").val()==''){
        setFancyBox('请输入开始时间');
        return false;
    }
    
    if ($(n).find('input[name=id]').val()=='') {
        action = $.cnuAction.getBaseUrl('/timeline/me/node/create', $.cookie('sid'));
    } else {
        action = $.cnuAction.getBaseUrl('/timeline/me/node/update', $.cookie('sid'));
    }
    $(n).attr('action', action);

    $(n).ajaxSubmit(function(d){
        if (d.rc==1) {
            setFancyBox('保存成功');
            if (d.id!=undefined){
                $(n).find('input[name=id]').val(d.id);
            }
        } else {
            setFancyBox('保存失败');
        }
    });
    return false;
}
//------- save node end
//------- remove node
function removeNode(b){
    id = $(b).parents('form').find("input[name='id']").val();
    if ( id!= ''){
        d = $(b).parents('#node-'+id);
        $.cnuAction.timelineNodeDelete(id, d);
    }
}
//------- remove node end

//
$(function(){
	$(".search-list li").hover(function(){
		$(this).addClass("active");
	},function(){
		$(this).removeClass("active");
	})

    //------- select type 
    function selectType(type){
        if ($('#p-type').val()==1) {
            $('#p-org1Id, #p-empNo').parent().hide();
            $('#p-deptId, #p-clazz, #p-adYear').parent().show();
        } else {
            $('#p-deptId, #p-clazz, #p-adYear').parent().hide();
            $('#p-org1Id, #p-empNo').parent().show();
        }
    }
    $('#p-type').change(function() {
        selectType($('#p-type').val());
    });
    selectType(1);
    //------- select type end
    //------- select Dept
    $.cnuAction.configDeptList();
    $.each($.cnuAction.deptList, function(i, v) {
        $('#p-deptId').append($("<option>").val(v.id).text(v.display));
        $('#p-deptId').find('option').eq(0).attr('selected', true);
        $.each(v.list, function(mi, mv){
            $('#p-majorId').append($("<option>").val(mv.id).text(mv.display));
        });
        $('#p-majorId').find('option').eq(0).attr('selected', true);
    });
    $('#p-deptId').change(function() {
        $.each($.cnuAction.deptList, function(i, v) {
            if (v.id==$('#p-deptId').val()) {
                $('#p-majorId').empty();
                $.each(v.list, function(mi, mv){
                    $('#p-majorId').append($("<option>").val(mv.id).text(mv.display));
                });
                $('#p-majorId').find('option').eq(0).attr('selected', true);
            }
        });
    });
    //------- select dept end
    //------- select org
    $.cnuAction.configOrgList();
    $.each($.cnuAction.orgList, function(i, v) {
        $('#p-org1Id').append($("<option>").val(v.id).text(v.display));
        $('#p-org1Id').find('option').eq(0).attr('selected', true);
        $.each(v.list, function(mi, mv){
            $('#p-org2Id').append($("<option>").val(mv.id).text(mv.display));
        });
        $('#p-org2Id').find('option').eq(0).attr('selected', true);
    });
    $('#p-org1Id').change(function() {
        $.each($.cnuAction.orgList, function(i, v) {
            if (v.id==$('#p-org1Id').val()) {
                $('#p-org2Id').empty();
                $.each(v.list, function(mi, mv){
                    $('#p-org2Id').append($("<option>").val(mv.id).text(mv.display));
                });
                $('#p-org2Id').find('option').eq(0).attr('selected', true);
            }
        });
    });
    //------- select org end

    //------- load & render profile
    function loadProfile(){
        $.cnuAction.configProFile();
        if ($.cnuAction.proFile.rc==-1 || $.cnuAction.proFile.rc==0) {
            return;
        }
        if ($.cnuAction.proFile.length>0){
            $.each($.cnuAction.proFile, function(i, v) {
                $('#p-form #p-'+i).val(v);
            });
        }
    }
    loadProfile();
    //------- load & render profile end
    //------- submit profile 
    $('#p-form').submit(function (){
        if ($.cookie('status')==-1){
            formAction = $.cnuAction.getBaseUrl('/profile/me/create', $.cookie('sid'));
        } else {
            formAction = $.cnuAction.getBaseUrl('/profile/me/update', $.cookie('sid'));
        }
        $(this).attr('action', formAction);
        // 表单判断
        if ($('#p-name').val()==''
            || $('#p-gender').val()==''
            || $('#p-type').val()=='') {
            setFancyBox('姓名、性别、类型为必填项！');
            return false;
        }
        if ($('#p-type').val()==1){
            if($('#p-deptId').val()==''
                || $('#p-majorId').val()==''
                || $('#p-clazz').val()==''
                || $('#p-adYear').val()==''){
                setFancyBox('请填写所属院校信息');
                return false;
            }
        }
        if ($('#p-type').val()==2){
            // org1Id org2Id empNo no null
            if ($('#p-org1Id').val()==''
                || $('#p-org2Id').val()==''
                || $('#p-empNo').val()==''){
                setFancyBox('请填写所属组织的信息');
                return false;
            }
        }


        // jquery.form 表单提交
        $(this).ajaxSubmit(function(d) {
            console.log(d);
            if( d.rc == 1 ){
                setFancyBox("保存成功");
                if( d.id != undefined ){}
            }else{
                setFancyBox("保存失败");
            }
        });
        return false;
    });
    //------- submit profile end


    // ============================================================================

    //------- select industry
    $.cnuAction.configIndustryList();
    $.each($.cnuAction.industryList, function(i,v) {
        $('#node-tpl #n-industry-id').append($("<option>").val(v.id).text(v.display));
        $('#node-tpl #n-industry-id').find('option').eq(0).attr('selected', true);
    });
    //------- select industry end
    //------- get the timeline
    $.cnuAction.timeline();
    if ($.cnuAction.timeLineList.length==0){

    } else {
        $.each($.cnuAction.timeLineList, function(i,v) {
            $('#node-tpl #n-after-id').append($('<option>').val(v.id).text(v.title));
            c = $('#node-tpl').clone();
            c.attr('id', 'node-'+v.id);
            c.css('display', '')
            c.find('input[name=id]').val(v.id)
            c.find('input[name=org]').val(v.org)
            c.find('input[name=city]').val(v.city)
            c.find('input[name=stime]').val(v.stime)
            c.find('input[name=etime]').val(v.etime)
            c.find('input[name=title]').val(v.title)
            c.find('input[name=province]').val(v.province)
            c.find('select[name=afterID]').val(v.afterID)
            c.find('select[name=industryId]').val(v.industryId)
            c.appendTo('#node-form-box');
        });
    }
    //------- get the timeline end

    //------- add new node
    $('#btn-node-add').click(function() {
        $('#node-tpl').clone().css('display', '').appendTo('#node-form-box');
    });




});
</script>
</body>
</html>
